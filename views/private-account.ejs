<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <title>Private Account</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f7f7f7;
      font-family: 'Arial', sans-serif;
    }
    .container {
      background-color: #fff;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      margin-top: 80px;
    }
    .profile-header img {
      width: 120px;
      height: 120px;
      object-fit: cover;
    }
    .btn-secondary {
      background-color: #007bff;
      color: white;
      border-radius: 30px;
    }
    .btn-secondary:hover {
      background-color: #0056b3;
    }
    .alert {
      margin-top: 20px;
      padding: 15px;
      background-color: #f9f9f9;
      border-left: 5px solid #ff6f61;
    }
  </style>
</head>
<body>

<div class="container text-center">

  <img src="<%= profileUser.avatar || '/default-avatar.png' %>" alt="Avatar" class="rounded-circle mb-2">
  <h2><%= profileUser.username %></h2>

  <% if (profileUser.isVerified) { %>
    <span class="badge bg-primary">‚úîÔ∏è Verified Account</span>
  <% } %>

  <div class="mt-2">
    <span><%= posts.length %> Posts</span> |
    <span>Followers: <span id="followersCount"><%= profileUser.followers.length %></span></span> |
    <span><%= profileUser.following.length %> Following</span>
  </div>

  <div class="mt-3">
    <% if (currentUser && currentUser._id.toString() !== profileUser._id.toString()) { %>
      <form id="followForm" method="POST" data-userid="<%= profileUser._id %>">
        <button type="submit" id="followButton" class="btn btn-sm <%= currentUser.following.includes(profileUser._id) ? 'btn-outline-danger' : 'btn-outline-primary' %>">
          <%= currentUser.following.includes(profileUser._id) ? 'Unfollow' : 'Follow' %>
        </button>
      </form>
    <% } %>
  </div>

  <div class="alert alert-info mt-4">
    üö´ This account is private. You need to follow <strong><%= profileUser.username %></strong> to see their content.
  </div>

  <a href="/" class="btn btn-secondary mt-4">Back to Home</a>

</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const followForm = document.getElementById('followForm');
    const followButton = document.getElementById('followButton');
    const followersCount = document.getElementById('followersCount');

    if (followForm) {
      followForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        const userId = this.getAttribute('data-userid');
        const isFollowing = followButton.innerText.trim() === 'Unfollow';
        const url = isFollowing ? `/users/unfollow/${userId}` : `/users/follow/${userId}`;

        try {
          const res = await fetch(url, { method: 'POST' });
          const data = await res.json();
          if (data.success) {
            followButton.innerText = isFollowing ? 'Follow' : 'Unfollow';
            followButton.classList.toggle('btn-outline-danger');
            followButton.classList.toggle('btn-outline-primary');
            followersCount.innerText = data.followersCount;
          }
        } catch (err) {
          alert('An error occurred. Please try again later.');
        }
      });
    }
  });
</script>

</body>
</html>
