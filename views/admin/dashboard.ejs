<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>User Admin Dashboard</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background-color: #f4f6f8;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    .card {
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    .post-actions button,
    .comment-actions button {
      margin-left: 5px;
    }
    h1, h3 {
      color: #222;
    }
    .stats-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: #007bff;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h1 class="mb-4">Welcome, <strong><%= currentUser.username %></strong></h1>

    <!-- Profile Info & Stats -->
    <div class="row mb-5">
      <div class="col-md-4">
        <div class="card p-3 text-center">
          <h5>Your Posts</h5>
          <p class="stats-number"><%= posts.length %></p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card p-3 text-center">
          <h5>Account Created</h5>
          <p><%= currentUser.createdAt.toDateString() %></p>
        </div>
      </div>
      <div class="col-md-4 d-flex align-items-center justify-content-center">
        <a href="/posts/new" class="btn btn-success w-100">Add New Post</a>
      </div>
    </div>

    <!-- Account Activity -->
    <h3>Account Activity</h3>
    <ul class="list-group mb-5">
      <li class="list-group-item">
        Last Login: <strong><%= currentUser.lastLogin ? currentUser.lastLogin.toDateString() : 'Never' %></strong>
      </li>
      <% if (recentActions && recentActions.length > 0) { %>
        <% recentActions.forEach(action => { %>
          <li class="list-group-item">
            <%= action.description %> - <small class="text-muted"><%= action.date.toLocaleString() %></small>
          </li>
        <% }) %>
      <% } else { %>
        <li class="list-group-item">No recent activities found.</li>
      <% } %>
    </ul>

    <!-- User Posts -->
    <h3>Your Posts</h3>
    <% if (userPosts.length === 0) { %>
      <p>You haven't created any posts yet.</p>
    <% } else { %>
      <ul class="list-group mb-5">
        <% userPosts.forEach(post => { %>
          <li class="list-group-item">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <a href="/posts/<%= post._id %>" class="h6">
                  <%= post.caption.length > 60 ? post.caption.substring(0, 60) + '...' : post.caption %>
                </a>
                <br />
                <small class="text-muted">Created: <%= post.createdAt.toDateString() %></small>
                <br />
                <small>Likes: <%= post.likesCount || 0 %> | Comments: <%= post.commentsCount || 0 %></small>
              </div>
              <div class="post-actions">
                <a href="/posts/edit/<%= post._id %>" class="btn btn-sm btn-primary">Edit</a>
                <form
                  action="/posts/delete/<%= post._id %>"
                  method="POST"
                  style="display:inline;"
                  onsubmit="return confirm('Are you sure you want to delete this post?');"
                >
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
              </div>
            </div>

            <!-- Comments management 
            <% if (post.comments && post.comments.length > 0) { %>
              <div class="mt-3">
                <h6>Comments (<%= post.comments.length %>):</h6>
                <ul class="list-group">
                  <% post.comments.forEach(comment => { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <div>
                        <strong><%= comment.user.username %>:</strong> <%= comment.text.length > 50 ? comment.text.substring(0, 50) + '...' : comment.text %>
                        <br />
                        <small class="text-muted"><%= comment.createdAt.toDateString() %></small>
                      </div>
                      <div class="comment-actions">
                        <form
                          action="/comments/delete/<%= comment._id %>"
                          method="POST"
                          style="display:inline;"
                          onsubmit="return confirm('Delete this comment?');"
                        >
                          <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                        </form>
                      </div>
                    </li>
                  <% }) %>
                </ul>
              </div>
            <% } %>
          </li>
        <% }) %>
      </ul>
    <% } %>
-->
    <!-- Account Management -->
    
    
      
      
      <div class="col-md-4 mb-3 d-flex align-items-center gap-2">
  <!-- Delete Account -->
  <!-- Edit Profile -->
  <a href="/users/editProfile" class="btn btn-warning">‚úèÔ∏è Edit Profile</a>

  <!-- Logout -->
  <form action="/auth/logout" method="POST" class="m-0">
    <button type="submit" class="btn btn-info text-white">üö™ Logout</button>
  </form>

  <!-- Back to Site -->
  <a href="/" class="btn btn-secondary">Back to Site</a>
</div>
<br>
<form action="/settings/delete" method="POST" onsubmit="return confirm('Are you sure you want to permanently delete your account? This cannot be undone!')">
      <button type="submit" class="btn btn-danger w-100">üóëÔ∏è Permanently Delete Account</button>
    </form>
    </div>

 
  </div>
</body>
</html>

