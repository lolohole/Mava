<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <title>Notifications</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --post-bg-color: #ffffff;
      --post-text-color: #000000;
      --chat-bg-color: #f5f5f5;
      --chat-text-color: #000000;
      --notification-color: #ffeb3b;
      --saved-posts-bg-color: #e0e0e0;
    }
    .post-card {
      background-color: var(--post-bg-color);
      color: var(--post-text-color);
    }
    .chat-box {
      background-color: var(--chat-bg-color);
      color: var(--chat-text-color);
    }
    .notification {
      background-color: var(--notification-color);
    }
    .saved-post {
      background-color: var(--saved-posts-bg-color);
    }
    .list-group-item {
      cursor: pointer;
    }
    .list-group-item.unread {
      font-weight: bold;
      background-color: #fff8c4;
    }
  </style>
</head>
<body class="container mt-4">

  <h2 class="mb-4">📢 Your Notifications</h2>
  <a href="/" class="btn btn-sm btn-outline-secondary mb-3">Back to Home</a>

  <form method="POST" action="/mark-read" class="mb-3">
    <button type="submit" class="btn btn-sm btn-success">Mark All as Read</button>
  </form>

  <ul class="list-group">
    <% if (notifications.length === 0) { %>
      <li class="list-group-item text-center text-muted">No notifications.</li>
    <% } else { %>
      <% notifications.forEach(n => { %>
        <li 
          class="list-group-item <%= n.isRead ? '' : 'unread' %>" 
          onclick="window.location.href='<%=
            (n.type === 'like' || n.type === 'comment' || n.type === 'share' || n.type === 'alert' || n.type === 'edit' || n.type === 'save' || n.type === 'unsave' || n.type === 'add' || n.type === 'delete' ) ? `/posts/${n.post?._id}` :
            (n.type === 'follow') ? `/users/${n.user?._id}` :
            (n.type === 'request' || n.type === 'order') ? `/orders/notification/${n._id}` : '#'
          %>'"
          title="Click to view details"
        >
          <%= n.message %> 
          <br>
          <small class="text-muted"><%= new Date(n.createdAt).toLocaleString() %></small>
        </li>
      <% }) %>
    <% } %>
  </ul>

  <script>
    // تفعيل الثيم المخصص للمستخدم
    const theme = <%- JSON.stringify(currentUser?.themeSettings || {}) %>;

    for (const [key, val] of Object.entries(theme)) {
      document.documentElement.style.setProperty('--' + key.replace(/([A-Z])/g, "-$1").toLowerCase(), val);
    }
  </script>
</body>
</html>
